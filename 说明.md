
# Introduction
This code completes the PABUF data-level parallel memory access control. The experiment used the verilator software simulation method and completed vectorized data read and write through custom RoCC instructions.

# Environment Set
#### Chipyard Version Information

```shell
commit c576a7e76717376b7a2cbbc0a531f51382ff87f1
Merge: 2c0928c 426a70f
Author: Abraham Gonzalez <abe.j.gonza@gmail.com>
Date:   Sun May 31 23:24:50 2020 -0700

    Merge pull request #500 from ucb-bar/dev
    
    Chipyard 1.3 Release
```

#### Environment Setup Reference [chipyard online mannul](https://chipyard.readthedocs.io/en/latest/Chipyard-Basics/Initial-Repo-Setup.html#initial-repository-setup)

**1. ubuntu16.04 dependencies**

```shell
#!/bin/bash

set -ex

sudo apt-get install -y build-essential bison flex software-properties-common curl
sudo apt-get install -y libgmp-dev libmpfr-dev libmpc-dev zlib1g-dev vim default-jdk default-jre
# install sbt: https://www.scala-sbt.org/release/docs/Installing-sbt-on-Linux.html#Ubuntu+and+other+Debian-based+distributions
echo "deb https://repo.scala-sbt.org/scalasbt/debian /" | sudo tee -a /etc/apt/sources.list.d/sbt.list
curl -sL "https://keyserver.ubuntu.com/pks/lookup?op=get&search=0x2EE0EA64E40A89B84B2DF73499E82A75642AC823" | sudo apt-key add
sudo apt-get update
sudo apt-get install -y sbt
sudo apt-get install -y texinfo gengetopt
sudo apt-get install -y libexpat1-dev libusb-dev libncurses5-dev cmake
# deps for poky
sudo apt-get install -y python3.8 patch diffstat texi2html texinfo subversion chrpath wget
# deps for qemu
sudo apt-get install -y libgtk-3-dev gettext
# deps for firemarshal
sudo apt-get install -y python3-pip python3.8-dev rsync libguestfs-tools expat ctags
# install DTC
sudo apt-get install -y device-tree-compiler
sudo apt-get install -y python
# install git >= 2.17
sudo add-apt-repository ppa:git-core/ppa -y
sudo apt-get update
sudo apt-get install git -y

# install verilator
sudo apt-get install -y autoconf
git clone http://git.veripool.org/git/verilator
cd verilator
git checkout v4.034
autoconf && ./configure && make -j$(nproc) && sudo make install
```



**2. Download the Chipyard Repo**

```shell
git clone https://github.com/ucb-bar/chipyard.git
cd chipyard
./scripts/init-submodules-no-riscv-tools.sh # chipyard 目录下
```



**3. Install the Toolchain**

```shell
./scripts/build-toolchains.sh riscv-tools # for a normal risc-v toolchain
source ./env.sh # 定义环境变量
```






# Introduction to Newly Added Files

The code, based on the Berkeley Rocket Chip SoC generator [chipyard 1.3 Release](https://github.com/ucb-bar/chipyard/releases/tag/1.3.0), includes the following additions:


**1. Hardware Generation Code**

-   Modified project configuration file: chipyard/build.sbt.
-   Memory access controller Chisel source code: chipyard/generators/memaccer (the readme in the memaccer folder explains the purpose of each file).
-   Modified SoC module configuration file: chipyard/generators/chipyard/src/main/scala/config/RocketConfigs.scala. This file is primarily for generating a custom SoC, with RocketConfigs.Scala adding the MemaccerAccel class to construct an SoC comprising the PABUF memory access controller and a Rocket core.

**2. Verilator Software Simulation Benchmarks-Related Files**

Verilator benchmarks simulation files are located in chipyard/sims/verilator

-   The generated-src folder contains the generated SoC.
    
-   The scripts folder contains the shell script folders for SoC generation (build) and benchmarks testing. (PS: The shell scripts use absolute paths, so you need to manually change them to your local paths).

    


# Basic Operations

**1. Set up the Chipyard Environment**

**2. Copy the Newly Added Files**

**3. Generate the SoC**

```shell
cd chipyard/sims/verilator/scipts/build
chmod +x *
./memaccerAccel
```


After executing the above code, the Verilator simulator will be generated under chipyard/sims/verilator, and the Verilog code of the SoC generated by Chisel will be saved in generated-src.

**4. Test Benchmarks**

```shell
cd chipayrd/sims/verilator/scripts/benchmarks/memaccerAccel
# ls # 包含了多个benchmark
# axpy  base  covariance  floyd-wayshall  gemm  gemm-opt  kmean
cd axpy # 向量乘法和加
./test.sh
```


**5. Customization**

Refer to the following for SoC parts writing:

-   [Chipyard online documentation](https://chipyard.readthedocs.io/en/latest/Chipyard-Basics/Initial-Repo-Setup.html#initial-repository-setup)
    
-   chipyard/generators/memaccer
    

For benchmarks extension and script references, refer to:

-   chipyard/sims/verilator/scripts/benchmarks/memaccerAccel
